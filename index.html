<!DOCTYPE html>
<html>
<head>
  <title>Dayton REAP</title>

  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style/screen.css" />

  <link rel="stylesheet" href="bower_components/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="bower_components/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="bower_components/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  <script src="bower_components/leaflet/dist/leaflet.js"></script>
  <script src="bower_components/leaflet.markercluster/dist/leaflet.markercluster-src.js"></script>
  <script src="data/reaps.json"></script>
</head>
<body>
  <div class="container">
    <div class="header"></div>
    <div>
      <div id="progress"><div id="progress-bar"></div></div>
      <div id="map"></div>
      <script type="text/javascript">
        var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          maxZoom: 18,
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors, Points &copy 2012 LINZ'
        }),
        latlng = L.latLng(39.758948, -84.191607);
        var map = L.map('map', { center: latlng, zoom: 10, layers: [tiles] });
        var progress = document.getElementById('progress');
        var progressBar = document.getElementById('progress-bar');
        function updateProgressBar(processed, total, elapsed, layersArray) {
          if (elapsed > 1000) {
            // if it takes more than a second to load, display the progress bar:
            progress.style.display = 'block';
            progressBar.style.width = Math.round(processed/total*100) + '%';
          }
          if (processed === total) {
            // all markers processed - hide the progress bar:
            progress.style.display = 'none';
          }
        }
        var markers = L.markerClusterGroup({ chunkedLoading: true, chunkProgress: updateProgressBar });
        var markerList = [];
        //console.log('start creating markers: ' + window.performance.now());
        for (var i = 0; i < points.length; i++) {
          var a = points[i];
          var title = a.parcelid;
          var marker = L.marker(L.latLng(parseFloat(a.locationdata.latitude), parseFloat(a.locationdata.longitude)), { title: title});
          marker.bindPopup(title);
          markerList.push(marker);
        }
        markers.addLayers(markerList);
        map.addLayer(markers);
      </script>
    </div>
    <div class="footer">
      <p><span class="glyphicon glyphicon-heart"></span> from the Code for Dayton team</p>
    </div>
  </div>
</body>
</html>
